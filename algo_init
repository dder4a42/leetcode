#!/bin/bash

# Algorithm Problem Environment Setup Script
# Usage: ./algo_init "Problem Title"

if [ $# -eq 0 ]; then
    echo "Usage: $0 \"Problem Title\""
    exit 1
fi

# Convert title to directory name (lowercase, spaces to underscores)
TITLE="$1"
DIR_NAME=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '_' | tr -cd 'a-z0-9_')

# Create directory
mkdir -p "$DIR_NAME"

# Create test_cases.txt with expected format:
# input_line
# expected_answer
# (blank line separator)
cat > "$DIR_NAME/test_cases.txt" << 'EOF'
# Test Cases Format:
# - Input lines (one or more)
# - "---" separator line
# - Expected Answer (Python literal - e.g., 9, "[0,1]", "[[1,2],[1,4]]")
# - Blank line separator between test cases
#
# Each input line becomes an argument to solve() method.

# Example 1: Single line input (traditional)
2 7 11 15
---
[0, 1]

# Example 2: Two line input (e.g., Two Sum with separate target)
[2, 7, 11, 15]
9
---
[0, 1]

# Example 3: Complex input with multiple lines
nums1 = [1,7,11]
nums2 = [2,4,6]
k = 3
---
[[1, 2], [1, 4], [1, 6]]

# Example 4: Matrix input
3
[[1,2,3],[4,5,6],[7,8,9]]
---
[[1,2,3],[4,5,6],[7,8,9]]

EOF

# Create solution.py with solver and test runner
cat > "$DIR_NAME/solution.py" << 'EOF'
#!/usr/bin/env python3
"""
LeetCode Problem: PROBLEM_TITLE
"""

import sys
import ast
from typing import List, Optional, Tuple, Any


class Solution:
    def solve(self, *args: str) -> Any:
        """
        Main solver function.
        Implement your algorithm here.

        Args:
            *args: Input lines for a single test case
            Each line is a string that you can parse as needed.
            Example:
                solve("[1,2,3]", "4") for two-line input
                solve("hello world") for single-line input

        Returns:
            Solution as appropriate Python type (int, str, list, etc.)
        """
        # TODO: Implement your solution
        # Parse args and return result
        # Example parsing:
        # if len(args) == 1:
        #     nums = list(map(int, args[0].split()))
        # elif len(args) == 2:
        #     nums = ast.literal_eval(args[0])
        #     target = int(args[1])
        pass


def parse_test_cases(filename: str = "test_cases.txt") -> List[Tuple[List[str], Any]]:
    """
    Parse test cases from file.
    Expected format:
      Line 1: First input line
      Line 2: Second input line (optional, can have multiple lines)
      ...
      Line N: "---" (separator line)
      Line N+1: Expected Answer (Python literal - e.g., 9, "[0,1]", "[[1,2],[1,4]]")
      Blank line separator between test cases
    
    Returns list of (input_args, expected_answer) tuples where input_args is a list of strings.
    """
    test_cases = []
    try:
        with open(filename, 'r') as f:
            lines = [line.rstrip('\n') for line in f]
    except FileNotFoundError:
        print(f"Error: {filename} not found.")
        return []

    i = 0
    while i < len(lines):
        # Skip comments and empty lines at the start
        while i < len(lines) and (lines[i].strip().startswith('#') or not lines[i].strip()):
            i += 1

        if i >= len(lines):
            break

        # Collect input lines until we hit "---" separator
        input_args = []
        while i < len(lines) and lines[i].strip() != "---" and not lines[i].strip().startswith('#'):
            if lines[i].strip():  # Skip empty lines within input
                input_args.append(lines[i].strip())
            i += 1

        # Skip the "---" separator line
        if i < len(lines) and lines[i].strip() == "---":
            i += 1

        if i >= len(lines):
            break

        # Skip empty lines between input and expected
        while i < len(lines) and not lines[i].strip():
            i += 1

        if i >= len(lines):
            break

        # Read expected answer line
        expected_line = lines[i]
        i += 1
        
        # Parse expected answer as Python literal
        try:
            expected_answer = ast.literal_eval(expected_line)
        except (SyntaxError, ValueError):
            # If not valid Python literal, keep as string
            expected_answer = expected_line

        test_cases.append((input_args, expected_answer))

        # Skip blank line separator between test cases
        while i < len(lines) and not lines[i].strip():
            i += 1

    return test_cases


def run_tests():
    """
    Run all test cases from test_cases.txt and print results.
    Shows PASS/FAIL for each test case.
    """
    solution = Solution()
    test_cases = parse_test_cases()

    if not test_cases:
        print("No test cases found in test_cases.txt")
        print("\nPlease add test cases in the format:")
        print("  input_line")
        print("  expected_answer")
        print("  (blank line separator)")
        return

    passed = 0
    failed = 0

    print("=" * 60)
    print(f"Running {len(test_cases)} test case(s)")
    print("=" * 60)

    for i, (input_args, expected) in enumerate(test_cases, 1):
        print(f"\nTest Case {i}:")
        print(f"  Input:    {input_args}")
        print(f"  Expected: {expected}")

        try:
            result = solution.solve(*input_args)
            print(f"  Output:   {result}")

            # Compare Python objects directly
            if result == expected:
                print(f"  Status:   [PASS]")
                passed += 1
            else:
                print(f"  Status:   [FAIL]")
                failed += 1

        except Exception as e:
            print(f"  Error:    {e}")
            print(f"  Status:   [FAIL]")
            failed += 1
            import traceback
            traceback.print_exc()

    print("\n" + "=" * 60)
    print(f"Results: {passed} passed, {failed} failed out of {len(test_cases)}")
    print("=" * 60)


def main():
    """Main entry point."""
    run_tests()


if __name__ == "__main__":
    main()
EOF

# Make the script executable
chmod +x "$DIR_NAME/solution.py"

echo "✓ LeetCode environment created: $DIR_NAME/"
echo ""
echo "Files created:"
echo "  ├── $DIR_NAME/test_cases.txt  (add test cases: input / expected / blank line)"
echo "  └── $DIR_NAME/solution.py     (implement your solution)"
echo ""
echo "Test case format (in test_cases.txt):"
echo "  2 7 11 15"
echo "  ---"
echo "  [0, 1]"
echo ""
echo "  [2, 7, 11, 15]"
echo "  9"
echo "  ---"
echo "  [0, 1]"
echo ""
echo "To get started:"
echo "  cd $DIR_NAME"
echo "  python3 solution.py"
